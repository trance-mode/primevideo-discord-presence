name: Auto Version Bump

on:
  push:
    tags:
      - 'v*'  # v1.2.3 ã¿ãŸã„ãªã‚¿ã‚° push ã«åå¿œ

jobs:
  bump-version:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ðŸ§® Extract version from tag
        id: extract_version
        run: |
          echo "NEW_VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_ENV

      - name: ðŸ›  Update version in manifest.json
        run: |
          sed -i "s/\"version\": \".*\"/\"version\": \"${NEW_VERSION}\"/" native/extension/manifest.json

      - name: ðŸ›  Update version in Cargo.toml
        run: |
          sed -i "s/^version = \".*\"/version = \"${NEW_VERSION}\"/" native/Cargo.toml

      - name: ðŸ›  Update version in log.js (if applicable)
        run: |
          if [ -f native/extension/log.js ]; then
            sed -i "s/const VERSION = '.*'/const VERSION = '${NEW_VERSION}'/" native/extension/log.js
          fi

      - name: âœ… Commit version updates
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add native/extension/manifest.json native/Cargo.toml native/extension/log.js || true
          git commit -m "ðŸ”– Bump version to ${NEW_VERSION}" || echo "No changes to commit"

      - name: ðŸš€ Push changes
        run: |
          git push
